<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>CurrentUserAccounts.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">AllTests (Apr 10, 2013 12:41:39 AM)</a> &gt; <a href="../../index.html" class="el_group">BackEnd</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.html" class="el_package">default</a> &gt; <span class="el_source">CurrentUserAccounts.java</span></div><h1>CurrentUserAccounts.java</h1><pre class="source lang-java linenums">/**
 * Swift Ticket -- Back End
 *
 * Copyright (C) 2013, Jonathan Gillett, Daniel Smullen, and Rayan Alfaheid
 * All rights reserved.
 *
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import com.google.common.base.Strings;

/**
 * CurrentUserAccounts Provides methods and attributes for interacting with the
 * current user accounts file in memory, and outputting to disk.
 * 
 * @author Jonathan Gillett
 * @author Daniel Smullen
 * @author Rayan Alfaheid
 */
public class CurrentUserAccounts
{
    private ArrayList&lt;User&gt; users;
    private String cuaFile;


    /**
     * Constructor for the class. Takes the path to the available tickets file, and opens it.
     * 
     * @param cuaFile The path to the current user accounts file. Unix-style paths only.
     * 
     * @throws FatalError Fatal errors occur under the following circumstances:
     * 			&lt;br&gt;The Current User Accounts file is missing, or not found at the path specified.
     * @throws IOException 
     * @throws NumberFormatException 
     */
<span class="fc" id="L58">    public CurrentUserAccounts(String cuaFile) throws FatalError, NumberFormatException, IOException</span>
    {
<span class="fc" id="L60">        this.cuaFile = cuaFile;</span>
<span class="fc" id="L61">        this.users = new ArrayList&lt;User&gt;();</span>
        
        /* Parse the current user accounts file */
<span class="fc" id="L64">        parse();</span>
<span class="fc" id="L65">    }</span>

    /**
     * Adds a User object to the current user accounts file collection.
     * 
     * @param user The User object to add to the current user accounts file collection.
     */
    public void addUser(User user)
    {
<span class="fc" id="L74">        users.add(user);</span>
<span class="fc" id="L75">    }</span>

    /**
     * Removes a User object from the current user accounts file collection, based
     * on the user's name. If there exists no User object with the specified username,
     * nothing happens.
     * 
     * @param username String containing the name of the user to delete.
     */
    public void deleteUser(String username)
    {
<span class="pc bpc" id="L86" title="1 of 2 branches missed.">        for (User user : users)</span>
        {
<span class="fc bfc" id="L88" title="All 2 branches covered.">            if (user.getUsername().equals(username))</span>
            {
<span class="fc" id="L90">                users.remove(user);</span>
<span class="fc" id="L91">                break;</span>
            }
        }
<span class="fc" id="L94">    }</span>
    
    /**
     * Access method for the contents of the current user accounts file.
     * 
     * @return Returns an ArrayList of User objects, which is the contents of the entire
     * current user accounts file collection.
     */
    public ArrayList&lt;User&gt; getAllUsers()
    {
<span class="fc" id="L104">    	return users;</span>
    }

    /**
     * Access method for a particular User object in the collection, by name. If
     * there exists no User object with the username specified, nothing happens.
     * 
     * @param username String specifying the username of the User object to match to.
     * 
     * @return Returns a User object with the username specified. Returns null if
     * no User object with that name exists.
     */
    public User getUser(String username)
    {
<span class="fc bfc" id="L118" title="All 2 branches covered.">        for (User user : users)</span>
        {
<span class="fc bfc" id="L120" title="All 2 branches covered.">            if (user.getUsername().equals(username))</span>
            {
<span class="fc" id="L122">                return user;</span>
            }
        }
        
<span class="fc" id="L126">        return null;</span>
    }

    /**
     * Determines whether a specified User exists in the current user 
     * accounts file, corresponding to the username specified.
     * 
     * @param username
     * 
     * @return Returns true if the username specified is in the current user
     * accounts file. Returns false if the username is not found.
     */
    public boolean hasUser(String username)
    {
<span class="fc bfc" id="L140" title="All 2 branches covered.">        for (User user : users)</span>
        {
<span class="fc bfc" id="L142" title="All 2 branches covered.">            if (user.getUsername().equals(username))</span>
            {
<span class="fc" id="L144">                return true;</span>
            }
        }
        
<span class="fc" id="L148">        return false;</span>
    }
    
    /**
     * Writes the current user accounts file in memory to file, over-writing
     * the old current user accounts file.
     * 
     * @throws FatalError Fatal errors occur under the following circumstances:
     * 			&lt;br&gt;The current user accounts file is corrupted.
     * @throws IOException 
     */
    public void write() throws IOException
    {
        BufferedWriter writer;
        String entry;
        
<span class="fc" id="L164">        File file = new File(cuaFile);</span>

<span class="fc" id="L166">        writer = new BufferedWriter(new FileWriter(file.getAbsoluteFile()));</span>
        
        /* Format each entry and write it to the file */
<span class="fc bfc" id="L169" title="All 2 branches covered.">        for (User user : users)</span>
        {                
            /* Format the username */
<span class="fc" id="L172">            entry = Strings.padEnd(user.getUsername(), 16, '_');</span>
            
            /* Format the account type */
<span class="fc" id="L175">            entry += user.getType() + &quot;_&quot;;</span>
            
            /* Format the credit amount */
<span class="fc" id="L178">            entry += Strings.padStart(String.format(&quot;%.2f&quot;, user.getCredit()), 9, '0') + &quot;\n&quot;;</span>
            
            
<span class="fc" id="L181">            writer.write(entry);</span>
        }
        
        /* Add the END of file identifier and close the file */
<span class="fc" id="L185">        writer.write(&quot;END________________000000.00&quot;);</span>
<span class="fc" id="L186">        writer.close();</span>
<span class="fc" id="L187">    }</span>

    /**
     * Parses the current user accounts file entries, matching the specified format
     * based on regular expressions.
     * 
     * @throws FatalError Fatal errors occur under the following circumstances:
     * 			&lt;br&gt;The Current User Accounts File is missing, or not found at the path specified.
     * 			&lt;br&gt;The current user accounts file is corrupted.
     * @throws IOException 
     * @throws NumberFormatException 
     */
    @SuppressWarnings(&quot;resource&quot;)
    private void parse() throws FatalError, NumberFormatException, IOException
    {
        BufferedReader reader;

        String line;
<span class="fc" id="L205">        Pattern re = Pattern.compile(&quot;^([A-Za-z0-9_]{1,15}?)_+(AA|FS|BS|SS)_([0-9]{6}\\.[0-9]{2})$&quot;);</span>
<span class="fc" id="L206">        Pattern reEnd = Pattern.compile(&quot;END_{16}0{6}\\.0{2}&quot;);</span>
        Matcher match;

        try
        {
<span class="fc" id="L211">            reader = new BufferedReader(new FileReader(cuaFile));</span>
<span class="fc" id="L212">        }</span>
<span class="fc" id="L213">        catch (FileNotFoundException e1)</span>
        {
<span class="fc" id="L215">            e1.printStackTrace();</span>
<span class="fc" id="L216">            throw new FatalError(ExceptionCodes.CUA_NOT_FOUND, cuaFile);</span>
        }

<span class="pc bpc" id="L219" title="1 of 4 branches missed.">        while ((line = reader.readLine()) != null &amp;&amp; !reEnd.matcher(line).matches())</span>
        {
<span class="fc" id="L221">            match = re.matcher(line);</span>
            
            /* Add each ticket found to the list of tickets */
<span class="pc bpc" id="L224" title="1 of 4 branches missed.">            if (Validate.cuaEntry(line) &amp;&amp; match.matches())</span>
            {
                /* Get each match from the entry in the file */
<span class="fc" id="L227">                String username = match.group(1);</span>
<span class="fc" id="L228">                String type = match.group(2);</span>
<span class="fc" id="L229">                Double credit = Double.parseDouble(match.group(3));</span>

                /* Add the ticket object to the array of tickets */
<span class="fc" id="L232">                users.add(new User(username, type, credit));</span>
<span class="fc" id="L233">            }</span>
            else
            {
<span class="fc" id="L236">                throw new FatalError(ExceptionCodes.CORRUPT_CUA, cuaFile);</span>
            }
        }
<span class="fc" id="L239">        reader.close();</span>
<span class="fc" id="L240">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.0.201210061924</span>AllTests (Apr 10, 2013 12:41:39 AM)</div></body></html>